<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> api接口规范 · Martin's Blog</title><meta name="description" content="api接口规范 - Martin D"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://dxyoo7.github.io/atom.xml" title="Martin's Blog"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">api接口规范</h1><div class="post-info">2016年7月7日</div><div class="post-content"><h1 id="转"><a href="#转" class="headerlink" title="转"></a>转</h1><h1 id="API接口规范完整版本"><a href="#API接口规范完整版本" class="headerlink" title="API接口规范完整版本"></a>API接口规范完整版本</h1><h2 id="整体规范建议采用RESTful-方式来实施。"><a href="#整体规范建议采用RESTful-方式来实施。" class="headerlink" title="整体规范建议采用RESTful 方式来实施。"></a>整体规范建议采用RESTful 方式来实施。</h2><h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><p>API与用户的通信协议，总是使用HTTPs协议，确保交互数据的传输安全。</p>
<h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><p>应该尽量将API部署在专用域名之下。<br><a href="https://api.example.com" target="_blank" rel="noopener">https://api.example.com</a></p>
<p>如果确定API很简单，不会有进一步扩展，可以考虑放在主域名下。<br><a href="https://example.org/api/" target="_blank" rel="noopener">https://example.org/api/</a></p>
<h2 id="api版本控制"><a href="#api版本控制" class="headerlink" title="api版本控制"></a>api版本控制</h2><p>应该将API的版本号放入URL。<br><a href="https://api.example.com/v{n}/" target="_blank" rel="noopener">https://api.example.com/v{n}/</a><br>另一种做法是，将版本号放在HTTP头信息中，但不如放入URL方便和直观。Github采用这种做法。</p>
<blockquote>
<ul>
<li>采用多版本并存，增量发布的方式<br>v{n} n代表版本号,分为整形和浮点型<br>整形的版本号: 大功能版本发布形式；具有当前版本状态下的所有API接口 ,例如：v1,v2<br>浮点型：为小版本号，只具备补充api的功能，其他api都默认调用对应大版本号的api 例如：v1.1 v2.2</li>
</ul>
</blockquote>
<h2 id="API-路径规则"><a href="#API-路径规则" class="headerlink" title="API 路径规则"></a>API 路径规则</h2><p>路径又称”终点”（endpoint），表示API的具体网址。<br>在RESTful架构中，每个网址代表一种资源（resource），所以网址中不能有动词，只能有名词，而且所用的名词往往与数据库的表格名对应。一般来说，数据库中的表都是同种记录的”集合”（collection），所以API中的名词也应该使用复数。<br>举例来说，有一个API提供动物园（zoo）的信息，还包括各种动物和雇员的信息，则它的路径应该设计成下面这样。</p>
<p><a href="https://api.example.com/v1/products" target="_blank" rel="noopener">https://api.example.com/v1/products</a><br><a href="https://api.example.com/v1/users" target="_blank" rel="noopener">https://api.example.com/v1/users</a><br><a href="https://api.example.com/v1/employees" target="_blank" rel="noopener">https://api.example.com/v1/employees</a></p>
<h2 id="HTTP请求方式"><a href="#HTTP请求方式" class="headerlink" title="HTTP请求方式"></a>HTTP请求方式</h2><p>对于资源的具体操作类型，由HTTP动词表示。<br>常用的HTTP动词有下面四个（括号里是对应的SQL命令）。<br>GET（SELECT）：从服务器取出资源（一项或多项）。<br>POST（CREATE）：在服务器新建一个资源。<br>PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。<br>DELETE（DELETE）：从服务器删除资源。</p>
<p>下面是一些例子。</p>
<p>GET /product：列出所有商品<br>POST /product：新建一个商品<br>GET /product/ID：获取某个指定商品的信息<br>PUT /product/ID：更新某个指定商品的信息<br>DELETE /product/ID：删除某个商品<br>GET /product/ID/purchase ：列出某个指定商品的所有投资者<br>get /product/ID/purchase/ID：获取某个指定商品的指定投资者信息<br>过滤信息</p>
<p>如果记录数量很多，服务器不可能都将它们返回给用户。API应该提供参数，过滤返回结果。</p>
<h2 id="下面是一些常见的参数。"><a href="#下面是一些常见的参数。" class="headerlink" title="下面是一些常见的参数。"></a>下面是一些常见的参数。</h2><p>?limit=10：指定返回记录的数量<br>?offset=10：指定返回记录的开始位置。<br>?page=2&amp;per_page=100：指定第几页，以及每页的记录数。<br>?sortby=name&amp;order=asc：指定返回结果按照哪个属性排序，以及排序顺序。<br>?producy_type=1：指定筛选条件</p>
<h2 id="API-传入参数"><a href="#API-传入参数" class="headerlink" title="API 传入参数"></a>API 传入参数</h2><p>参入参数分为4种类型：</p>
<p>地址栏参数</p>
<ul>
<li>restful 地址栏参数 /api/v1/product/122 122为产品编号，获取产品为122的信息</li>
<li>get方式的查询字串 见过滤信息小节<br>请求body数据<br>cookie<br>request header<br>cookie和header 一般都是用于OAuth认证的2种途径</li>
</ul>
<h2 id="返回数据"><a href="#返回数据" class="headerlink" title="返回数据"></a>返回数据</h2><p>只要api接口成功接到请求，就不能返回200以外的HTTP状态。<br>为了保障前后端的数据交互的顺畅，建议规范数据的返回，并采用固定的数据格式封装。</p>
<p>接口返回模板：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">status:0,</span><br><span class="line">data:&#123;&#125;||[],</span><br><span class="line">msg:’’</span><br><span class="line">&#125;</span><br><span class="line">status: //接口的执行的状态</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">=0表示成功</span><br><span class="line">&lt;0 表示有异常 </span><br><span class="line">》0 表示接口有部分执行失败</span><br></pre></td></tr></table></figure>
<p>Data 接口的主数据</p>
<blockquote>
<ul>
<li>可以根据实际返回数组或JSON对象</li>
</ul>
</blockquote>
<p>Msg<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当status!=0 都应该有错误信息</span><br></pre></td></tr></table></figure></p>
<h1 id="非Restful-Api的需求"><a href="#非Restful-Api的需求" class="headerlink" title="非Restful Api的需求"></a>非Restful Api的需求</h1><p>由于实际业务开展过程中，可能会出现各种的api不是简单的restful 规范能实现的，因此，需要有一些api突破restful规范原则。特别是移动互联网的api设计，更需要有一些特定的api来优化数据请求的交互。</p>
<h2 id="页面级的api"><a href="#页面级的api" class="headerlink" title="页面级的api"></a>页面级的api</h2><p>把当前页面中需要用到的所有数据通过一个接口一次性返回全部数据</p>
<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><p>api/v1/get-home-data 返回首页用到的所有数据</p>
<p>这类API有一个非常不好的地址，只要业务需求变动，这个api就需要跟着变更。</p>
<h2 id="自定义组合api"><a href="#自定义组合api" class="headerlink" title="自定义组合api"></a>自定义组合api</h2><p>把当前用户需要在第一时间内容加载的多个接口合并成一个请求发送到服务端，服务端根据请求内容，一次性把所有数据合并返回,相比于页面级api，具备更高的灵活性，同时又能很容易的实现页面级的api功能。<br>规范</p>
<p>地址：api/v1/batApi</p>
<p>传入参数：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data:[</span><br><span class="line">&#123;url:'api1',type:'get',data:&#123;...&#125;&#125;,</span><br><span class="line">&#123;url:'api2',type:'get',data:&#123;...&#125;&#125;,</span><br><span class="line">&#123;url:'api3',type:'get',data:&#123;...&#125;&#125;,</span><br><span class="line">&#123;url:'api4',type:'get',data:&#123;...&#125;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="返回数据-1"><a href="#返回数据-1" class="headerlink" title="返回数据"></a>返回数据</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;status:0,msg:'',</span><br><span class="line">data:[</span><br><span class="line">&#123;status:0,msg:'',data:[]&#125;,</span><br><span class="line">&#123;status:-1,msg:'',data:&#123;&#125;&#125;,</span><br><span class="line">&#123;status:1,msg:'',data:&#123;&#125;&#125;,</span><br><span class="line">&#123;status:0,msg:'',data:[]&#125;,</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a href="/2016/07/08/Android-Themes-An-in-depth-guide/" class="prev">上一篇</a><a href="/2016/05/06/config-multiple-ssh-of-git/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2017 <a href="http://dxyoo7.github.io">Martin D</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>